애플리케이션을 개발할 때 데이터의 일관성을 유지하고 안정적인 동작을 보호하기 위해 트랜잭션 관리가 필수적입니다.   
트랜잭션은 데이터를 처리하는 동안 발생할 수 있는 오류나 시스템 장애에 대비해 작업을 `롤백(rollback)`하거나 `커밋(commit)`하는 중요한 역할을 합니다. `트랜잭션 전파(Transaction Propagation)`는 여러 개의 트랜잭션이 서로 어떻게 상호작용하고, 하나의 트랜잭션이 다른 트랜잭션에게 어떻게 영향을 미칠지 결정하는 중요한 개념입니다.   
트랜잭션 전파는 애플리케이션에서 복잡한 비즈니스 로직을 처리할 때 필수적인 기술로, 각 서비스가 다른 서비스의 트랜잭션에 참여할 때 발생할 수 있는 문제들을 해결하는 데 중요한 역할을 합니다.   
이번 포스팅에서는 트랜잭션 전파에서 각 속성들의 개념과 동작과정에 대해 알아보도록 하겠습니다.

# 트랜잭션 전파 속성(Transaction Propagation)이란?

Spring이 제공하는 선언적 트랜잭션(@Transactional)은 여러 트랜잭션을 묶어 하나의 큰 트랜잭션 경계를 설정할 수 있는 장점이 있습니다.      
여기서 `트랜잭션 전파 속성(Propagation)`은 이미 트랜잭션이 진행 중일 때, 새로운 트랜잭션이 어떻게 처리될지를 결정하는 중요한 개념입니다.   
전파 속성에 따라 기존의 트랜잭션에 참여하거나, 새로운 트랜잭션을 시작하거나, 에러를 발생시키는 등 다양한 행동을 선택할 수 있습니다. 이는 애플리케이션의 복잡한 비즈니스 로직을 처리하는 데 유용하게 사용됩니다.   

스프링 프레임워크의 `org.springframework.transaction.annotation 패키지에 있는 @Transactional` 어노테이션은 트랜잭션의 전파 레벨을 정할 수 있습니다.   
```text
// ex
@Transactional(propagation = Propagation.REQUIRED)
```

# 물리 트랜잭션과 논리 트랜잭션

<img width="811" alt="Image" src="https://github.com/user-attachments/assets/ee759bfb-c431-49ff-aad1-c30cd7e5caf7" />

트랜잭션은 데이터베이스에서 제공하는 기술이므로 커넥션 객체를 통해 처리합니다. 한 개의 트랜잭션을 사용한다는 것은 하나의 커넥션 객체를 사용한다는 것이고, 실제 데이터베이스의 트랜잭션을 사용한다는 점에서 물리 트랜잭션이라고도 합니다. 물리 트랜잭션은 실제 커넥션에 `롤백, 커밋`을 호출하여 해당 트랜잭션의 종료를 의미합니다.

동작 과정
1. 물리 트랜잭션 시작 (Transaction Start)
   - 물리 트랜잭션은 실제 데이터베이스에서 트랜잭션을 시작하는 단계입니다. 데이터베이스와 연결된 커넥션을 통해 트랜잭션이 시작됩니다.
   - 물리 트랜잭션 → DB (Transaction Start)
2. 논리 트랜잭션이 물리 트랜잭션에 연결
   - 논리 트랜잭션이 시작되면, 그 논리 트랜잭션은 하나 이상의 물리 트랜잭션에 포함ㅁ될 수 있습니다. 즉, 논리 트랜잭션은 물리 트랜잭션을 포함하거나, 물리 트랜잭션을 관리하는 역할을 하게 됩니다.
   - 논리 트랜잭션 → 물리 트랜잭션 (Transaction Start)
3. 논리 트랜잭션 종료
   - 논리 트랜잭션이 종료될 때, 그 안에 포함된 모든 물리 트랜잭션도 커밋하거나 롤백을 통해 종료되어야 합니다. 논리 트랜잭션이 성공적으로 커밋되면, 그에 속한 물리 트랜잭션도 커밋됩니다.
   - 논리 트랜잭션 종료 (commit) → 물리 트랜잭션
4. 물리 트랜잭션 커밋
   - 논리 트랜잭션이 종료되면, 물리 트랜잭션은 DB에 실제 변경을 반영하기 위해 커밋됩니다. 이때, 물리 트랜잭션의 상태가 DB에 반영되고 트랜잭션이 종료됩니다.
   - 물리 트랜잭션 → DB (commit)
5. 하나의 트랜잭션 종료
   - 논리 트랜잭션과 그에 속한 모든 물리 트랜잭션이 커밋되면 전체 트랜잭션이 종료됩니다.

- 물리 트랜잭션: 실제 데이터베이스에 적용되는 트랜잭션으로, 커넥션을 통해 `커밋, 롤백`하는 단위
- 논리 트랜잭션: 스프링이 트랜잭션 매니저를 통해 트랜잭션을 처리하는 단위
  - 모든 `논리 트랜잭션이 커밋 되어야 물리 트랜잭션이 커밋`됩니다.
  - `하나의 논리 트랜잭션이라도 롤백되면 물리 트랜잭션 또한 롤백`됩니다.
